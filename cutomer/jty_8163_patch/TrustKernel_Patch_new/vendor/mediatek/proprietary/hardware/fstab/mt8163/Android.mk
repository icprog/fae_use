LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)
FSTAB_OUT := $(PRODUCT_OUT)/obj/FAKE
LOCAL_PREBUILT_MODULE_FILE := $(FSTAB_OUT)/fstab.mt8163

LOCAL_MODULE := fstab.mt8163
LOCAL_PROPRIETARY_MODULE := true
LOCAL_MODULE_OWNER := mtk
LOCAL_SRC_FILES := fstab.mt8163
LOCAL_MODULE_CLASS := FAKE
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/$(TARGET_COPY_OUT_VENDOR)/etc

ifeq ($(strip $(MTK_NAND_MTK_FTL_SUPPORT)),yes)
__CFLAGS += -D__MTK_FTL_SUPPORT
endif
ifeq ($(strip $(MTK_PERSIST_PARTITION_SUPPORT)),yes)
__CFLAGS += -D__PERSIST_PARTITION_SUPPORT
endif
ifeq ($(strip $(MTK_EMMC_SUPPORT)),yes)
__CFLAGS += -D__MTK_EMMC_SUPPORT
endif
ifeq ($(strip $(MTK_ATF_SUPPORT)),yes)
__CFLAGS += -D__MTK_ATF_SUPPORT
endif
ifeq ($(strip $(MTK_TEE_SUPPORT)),yes)
__CFLAGS += -D__MTK_TEE_SUPPORT
endif
ifneq ($(strip $(BOARD_SYSTEMIMAGE_FILE_SYSTEM_TYPE)),)
__CFLAGS += -D__MTK_SYSIMG_FSTYPE=$(BOARD_SYSTEMIMAGE_FILE_SYSTEM_TYPE)
endif

ifeq ($(strip $(MTK_ENCRYPTION_DEFAULT_OFF)),yes)
  __CFLAGS += -D__MTK_FDE_NO_FORCE
else ifeq ($(strip $(CUSTOM_CONFIG_MAX_DRAM_SIZE)),0x20000000)
  __CFLAGS += -D__MTK_FDE_NO_FORCE
endif
ifeq ($(strip $(MTK_TEE_SUPPORT)),yes)
ifeq ($(strip $(MTK_ENCRYPTION_TYPE_FILE)),yes)
  __CFLAGS += -D__MTK_FDE_TYPE_FILE
ifeq ($(strip $(MTK_ENCRYPTION_FDE_TO_FBE)),yes)
  __CFLAGS += -D__MTK_FDE_TO_FBE
endif
endif
endif
ifeq (true,$(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_SUPPORTS_VERITY))
__CFLAGS += -D__MTK_SEC_VERITY
endif

ifeq ($(strip $(MTK_IN_HOUSE_TEE_SUPPORT)),yes)
ifeq ($(strip $(MTK_DRM_KEY_MNG_SUPPORT)),yes)
__CFLAGS += -D__KB_DKB_PARTITION_SUPPORT
endif
endif

ifeq ($(strip $(TARGET_COPY_OUT_VENDOR)),vendor)
  __CFLAGS += -D__VENDOR_PARTITION_SUPPORT
endif

ifeq ($(strip $(MTK_DTBO_FEATURE)),yes)
  __CFLAGS += -D__MTK_DTBO_FEATURE
endif
ifeq ($(strip $(MTK_AB_OTA_UPDATER)),yes)
  __CFLAGS += -D__MTK_AB_OTA_UPDATER
endif
ifeq ($(strip $(TARGET_COPY_OUT_ODM)),yes)
  __CFLAGS += -D__ODM_PARTITION_SUPPORT
endif

ifeq ($(TARGET_BUILD_VARIANT),user)
  __CFLAGS += -D__TARGET_ENABLE_QUOTA
endif

ifeq ($(TRUSTKERNEL_TEE_SUPPORT),yes)
	__CFLAGS += -D__TRUSTKERNEL_TEE_SUPPORT
endif

$(LOCAL_PREBUILT_MODULE_FILE): $(LOCAL_PATH)/fstab.in $(MTK_TARGET_PROJECT_FOLDER)/ProjectConfig.mk
	@echo "Generate fstab"
	@echo "MTK_NAND_MTK_FTL_SUPPORT $(MTK_NAND_MTK_FTL_SUPPORT)"
	@echo "MTK_PERSIST_PARTITION_SUPPORT $(MTK_PERSIST_PARTITION_SUPPORT)"
	@echo "MTK_EMMC_SUPPORT $(MTK_EMMC_SUPPORT)"
	@echo "MTK_ATF_SUPPORT $(MTK_ATF_SUPPORT)"
	@echo "MTK_TEE_SUPPORT $(MTK_TEE_SUPPORT)"
	@echo "MTK_IN_HOUSE_TEE_SUPPORT $(MTK_IN_HOUSE_TEE_SUPPORT)"
	@echo "MTK_DRM_KEY_MNG_SUPPORT $(MTK_DRM_KEY_MNG_SUPPORT)"
	@echo "BOARD_SYSTEMIMAGE_FILE_SYSTEM_TYPE $(BOARD_SYSTEMIMAGE_FILE_SYSTEM_TYPE)"
	@echo "MTK_FDE_NO_FORCE $(MTK_FDE_NO_FORCE)"
	@echo "MTK_FDE_TYPE_FILE $(MTK_FDE_TYPE_FILE)"
	@echo "CUSTOM_CONFIG_MAX_DRAM_SIZE $(CUSTOM_CONFIG_MAX_DRAM_SIZE)"
	@echo "PRODUCT_SUPPORTS_VERITY $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_SUPPORTS_VERITY)"
	@echo "TARGET_COPY_OUT_VENDOR $(TARGET_COPY_OUT_VENDOR)"
	@echo "MTK_DTBO_FEATURE $(MTK_DTBO_FEATURE)"
	@echo "MTK_AB_OTA_UPDATER $(MTK_AB_OTA_UPDATER)"
	@echo "TARGET_COPY_OUT_ODM $(TARGET_COPY_OUT_ODM)"
	mkdir -p $(FSTAB_OUT)
	gcc $(__CFLAGS) -x c -E $< -o $@

include $(BUILD_PREBUILT)


